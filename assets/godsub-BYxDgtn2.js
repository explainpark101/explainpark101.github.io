import{E as e,M as t,O as n,S as r,_ as i,b as a,f as o,h as s,k as c,v as l,w as u,x as d}from"./index-BT2NL5gZ.js";import{t as f}from"./_plugin-vue_export-helper-9n1O4nl6.js";var p={class:`godsub-container`},m={class:`container z-depth-2 white`,style:{padding:`32px 24px 24px 24px`}},h={id:`img-form`},g={class:`file-field input-field`},_={class:`btn`},v={class:`range-field`,style:{"margin-bottom":`24px`}},y=[`value`],b={id:`humanPositionValue`,style:{"margin-left":`8px`,color:`#1976d2`,"font-weight":`500`}},x=f({__name:`index`,setup(f){let x=null,S=null,C=n(0),w=null,T=null,E=null,D=n(null),O=n(null);async function k(e){let t=await(await fetch(e)).blob(),n=await new Promise(e=>{let n=new FileReader;n.onload=t=>e(t.target.result),n.readAsDataURL(t)});return await new Promise(e=>{let t=new Image;t.onload=()=>e(t),t.src=n})}async function A(e){if(!e.files||!e.files[0])return null;let t=await new Promise(t=>{let n=new FileReader;n.onload=e=>t(e.target.result),n.readAsDataURL(e.files[0])});return await new Promise(e=>{let n=new Image;n.onload=()=>e(n),n.src=t})}async function j(e){if(!T)return alert(`glfx.js가 정상적으로 로드되지 않았습니다.`),null;let t=e.width,n=e.height,r=e;if(t<1e3||n<600){let i=document.createElement(`canvas`);i.width=Math.max(t,1e3),i.height=Math.max(n,800),i.getContext(`2d`).drawImage(e,0,0,i.width,i.height),r=await new Promise(e=>{let t=new Image;t.onload=()=>e(t),t.src=i.toDataURL()}),t=i.width,n=i.height}let i=T.canvas(),a=i.texture(r),o=[0,0,t,0,t,n,0,n];i.draw(a).perspective(o,[93,132,458,69,523,517,150,586]).update();let s=document.createElement(`canvas`);s.width=t,s.height=n,s.getContext(`2d`).drawImage(i,0,0);let c=s.toDataURL();return await new Promise(e=>{let t=new Image;t.onload=()=>e(t),t.src=c})}async function M(){if(!x||!S)return;let e=x.width,t=x.height,n=document.createElement(`canvas`);n.width=e,n.height=t;let r=n.getContext(`2d`);r.clearRect(0,0,e,t),r.drawImage(x,0,0);let i=await j(S);i&&r.drawImage(i,0,0);let a=n.toDataURL();w=await new Promise(e=>{let t=new Image;t.onload=()=>e(t),t.src=a});let o=D.value;if(o&&w){o.width=w.width,o.height=w.height;let e=o.getContext(`2d`);e.clearRect(0,0,o.width,o.height),e.drawImage(w,0,0)}}let N=async e=>{S=await A(e.target),S&&await M()},P=async e=>{C.value=parseFloat(e.target.value)},F=async()=>{await M(),E&&E.toast({html:`합성이 완료되었습니다!`,classes:`blue`})},I=()=>{let e=D.value;if(!e)return;let t=O.value;t&&e.toBlob(function(e){let n=URL.createObjectURL(e);t.href=n,t.download=`result.png`,t.style.display=`inline-block`,t.textContent=`다운로드`,t.click(),setTimeout(()=>{URL.revokeObjectURL(n),t.style.display=`none`},1e3)},`image/png`)},L=async e=>{if(!(!navigator.clipboard||!navigator.clipboard.read))try{let e=await navigator.clipboard.read();for(let t of e)for(let e of t.types)if(e.startsWith(`image/`)){let n=await t.getType(e),r=new File([n],`pasted-image.png`,{type:n.type}),i=new DataTransfer;i.items.add(r);let a=document.getElementById(`target-input`);a.files=i.files;let o=new Event(`change`,{bubbles:!0});a.dispatchEvent(o),E&&E.toast({html:`클립보드 이미지를 붙여넣었습니다.`,classes:`blue`});return}}catch{E&&E.toast({html:`클립보드에서 이미지를 읽을 수 없습니다.`,classes:`red`})}},R=()=>new Promise(e=>{if(!document.querySelector(`link[href*="material-icons"]`)){let e=document.createElement(`link`);e.rel=`stylesheet`,e.href=`https://fonts.googleapis.com/icon?family=Material+Icons`,document.head.appendChild(e)}if(!document.querySelector(`link[href*="materialize"]`)){let e=document.createElement(`link`);e.rel=`stylesheet`,e.href=`https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css`,document.head.appendChild(e)}if(window.M)E=window.M,e();else{let t=document.createElement(`script`);t.src=`https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js`,t.onload=()=>{E=window.M,e()},document.head.appendChild(t)}}),z=()=>new Promise(e=>{if(window.fx){T=window.fx,e();return}let t=document.createElement(`script`);t.src=`https://cdn.jsdelivr.net/npm/glfx@0.0.4/glfx.min.js`,t.onload=()=>{T=window.fx,T||alert(`glfx.js가 정상적으로 로드되지 않았습니다. 네트워크 상태를 확인하거나, CDN 주소를 확인하세요.`),e()},document.head.appendChild(t)});return a(async()=>{await R(),await z(),x=await k(`/imgs/godsub/board.jpg`);let e=document.getElementById(`humanPosition`);e&&x&&(e.max=x.width,e.value=0,C.value=0),window.addEventListener(`paste`,L)}),d(()=>{window.removeEventListener(`paste`,L)}),(n,a)=>{let d=u(`router-link`);return r(),s(`div`,p,[l(d,{to:`/`,class:`home-button`},{default:e(()=>[...a[0]||=[o(`i`,{class:`material-icons`,style:{"font-size":`18px`}},`home`,-1),i(` 앱 목록 `,-1)]]),_:1}),o(`div`,m,[a[7]||=o(`h1`,{class:`center-align`},[o(`i`,{class:`material-icons left`},`layers`),i(`마작부장 강의장면 만들기 `)],-1),o(`form`,h,[o(`div`,g,[o(`div`,_,[a[1]||=o(`span`,null,`타겟(target.png)`,-1),o(`input`,{type:`file`,id:`target-input`,accept:`image/*`,onChange:N},null,32)]),a[2]||=o(`div`,{class:`file-path-wrapper`},[o(`input`,{class:`file-path validate`,type:`text`,placeholder:`Perspective 변환할 이미지를 선택하세요`})],-1)])]),o(`div`,{class:`center-align`,style:{margin:`24px 0`}},[o(`button`,{id:`make-btn`,class:`btn waves-effect waves-light`,onClick:F},[...a[3]||=[o(`i`,{class:`material-icons left`},`layers`,-1),i(`최종 이미지 만들기 `,-1)]]),o(`button`,{id:`save-btn`,class:`btn green waves-effect waves-light`,onClick:I},[...a[4]||=[o(`i`,{class:`material-icons left`},`file_download`,-1),i(`PNG로 저장 `,-1)]])]),o(`canvas`,{id:`result-canvas`,ref_key:`resultCanvas`,ref:D},null,512),o(`div`,v,[a[5]||=o(`label`,{for:`humanPosition`,style:{color:`#1976d2`,"font-weight":`500`}},`인물 X 위치`,-1),o(`input`,{type:`range`,id:`humanPosition`,min:`0`,max:`1000`,step:`0.1`,value:c(C),onInput:P},null,40,y),o(`span`,b,t(c(C)),1)]),o(`a`,{id:`download-link`,class:`download-link btn blue`,style:{display:`none`},ref_key:`downloadLink`,ref:O},[...a[6]||=[o(`i`,{class:`material-icons left`},`file_download`,-1),i(`다운로드 `,-1)]],512)])])}}},[[`__scopeId`,`data-v-fd816da0`]]);export{x as default};