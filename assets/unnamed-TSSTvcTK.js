import{A as e,C as t,D as n,N as r,S as i,T as a,g as o,k as s,p as c,v as l,x as u,y as d}from"./index-DsoFNqQt.js";import{t as f}from"./_plugin-vue_export-helper-9n1O4nl6.js";var p={class:`unnamed-container`},m={class:`container z-depth-2 white`,style:{padding:`32px 24px 24px 24px`}},h={id:`img-form`},g={class:`file-field input-field`},_={class:`btn`},v={class:`range-field`,style:{"margin-bottom":`24px`}},y=[`value`],b={id:`humanPositionValue`,style:{"margin-left":`8px`,color:`#1976d2`,"font-weight":`500`}},x=f({__name:`index`,setup(f){let x=null,S=null,C=null,w=s(0),T=null,E=null,D=null,O=s(null),k=s(null);async function A(e){let t=await(await fetch(e)).blob(),n=await new Promise(e=>{let n=new FileReader;n.onload=t=>e(t.target.result),n.readAsDataURL(t)});return await new Promise(e=>{let t=new Image;t.onload=()=>e(t),t.src=n})}async function j(e){if(!e.files||!e.files[0])return null;let t=await new Promise(t=>{let n=new FileReader;n.onload=e=>t(e.target.result),n.readAsDataURL(e.files[0])});return await new Promise(e=>{let n=new Image;n.onload=()=>e(n),n.src=t})}async function M(e){if(!E)return alert(`glfx.js가 정상적으로 로드되지 않았습니다.`),null;let t=e.width,n=e.height,r=e;if(t<1e3||n<600){let i=document.createElement(`canvas`);i.width=Math.max(t,1e3),i.height=Math.max(n,800),i.getContext(`2d`).drawImage(e,0,0,i.width,i.height),r=await new Promise(e=>{let t=new Image;t.onload=()=>e(t),t.src=i.toDataURL()}),t=i.width,n=i.height}let i=E.canvas(),a=i.texture(r),o=[0,0,t,0,t,n,0,n];i.draw(a).perspective(o,[107,134,946,41,957,645,95,588]).update();let s=document.createElement(`canvas`);s.width=t,s.height=n,s.getContext(`2d`).drawImage(i,0,0);let c=s.toDataURL();return await new Promise(e=>{let t=new Image;t.onload=()=>e(t),t.src=c})}async function N(){if(!x||!S)return;let e=x.width,t=x.height,n=document.createElement(`canvas`);n.width=e,n.height=t;let r=n.getContext(`2d`);r.clearRect(0,0,e,t),r.drawImage(x,0,0);let i=await M(S);i&&r.drawImage(i,0,0);let a=n.toDataURL();T=await new Promise(e=>{let t=new Image;t.onload=()=>e(t),t.src=a})}async function P(){if(!T||!C)return;let e=O.value;if(!e)return;e.width=T.width,e.height=T.height;let t=e.getContext(`2d`);t.clearRect(0,0,e.width,e.height),t.drawImage(T,0,0),t.drawImage(C,w.value,e.height-C.height)}let F=async e=>{S=await j(e.target),S&&(await N(),await P())},I=async e=>{w.value=parseFloat(e.target.value),await P()},L=async()=>{await N(),await P(),D&&D.toast({html:`합성이 완료되었습니다!`,classes:`blue`})},R=()=>{let e=O.value;if(!e)return;let t=k.value;t&&e.toBlob(function(e){let n=URL.createObjectURL(e);t.href=n,t.download=`result.png`,t.style.display=`inline-block`,t.textContent=`다운로드`,t.click(),setTimeout(()=>{URL.revokeObjectURL(n),t.style.display=`none`},1e3)},`image/png`)},z=async e=>{if(!(!navigator.clipboard||!navigator.clipboard.read))try{let e=await navigator.clipboard.read();for(let t of e)for(let e of t.types)if(e.startsWith(`image/`)){let n=await t.getType(e),r=new File([n],`pasted-image.png`,{type:n.type}),i=new DataTransfer;i.items.add(r);let a=document.getElementById(`target-input`);a.files=i.files;let o=new Event(`change`,{bubbles:!0});a.dispatchEvent(o),D&&D.toast({html:`클립보드 이미지를 붙여넣었습니다.`,classes:`blue`});return}}catch{D&&D.toast({html:`클립보드에서 이미지를 읽을 수 없습니다.`,classes:`red`})}},B=()=>new Promise(e=>{if(!document.querySelector(`link[href*="material-icons"]`)){let e=document.createElement(`link`);e.rel=`stylesheet`,e.href=`https://fonts.googleapis.com/icon?family=Material+Icons`,document.head.appendChild(e)}if(!document.querySelector(`link[href*="materialize"]`)){let e=document.createElement(`link`);e.rel=`stylesheet`,e.href=`https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css`,document.head.appendChild(e)}if(window.M)D=window.M,e();else{let t=document.createElement(`script`);t.src=`https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js`,t.onload=()=>{D=window.M,e()},document.head.appendChild(t)}}),V=()=>new Promise(e=>{if(window.fx){E=window.fx,e();return}let t=document.createElement(`script`);t.src=`https://cdn.jsdelivr.net/npm/glfx@0.0.4/glfx.min.js`,t.onload=()=>{E=window.fx,E||alert(`glfx.js가 정상적으로 로드되지 않았습니다. 네트워크 상태를 확인하거나, CDN 주소를 확인하세요.`),e()},document.head.appendChild(t)});return u(async()=>{await B(),await V(),x=await A(`/imgs/unnamed/board.png`),C=await A(`/imgs/unnamed/man.png`);let e=document.getElementById(`humanPosition`);e&&x&&(e.max=x.width,e.value=0,w.value=0),window.addEventListener(`paste`,z)}),i(()=>{window.removeEventListener(`paste`,z)}),(i,s)=>{let u=a(`router-link`);return t(),o(`div`,p,[d(u,{to:`/`,class:`home-button`},{default:n(()=>[...s[0]||=[c(`i`,{class:`material-icons`,style:{"font-size":`18px`}},`home`,-1),l(` 앱 목록 `,-1)]]),_:1}),c(`div`,m,[s[7]||=c(`h1`,{class:`center-align`},[c(`i`,{class:`material-icons left`},`layers`),l(`마작부장 강의장면 만들기 `)],-1),c(`form`,h,[c(`div`,g,[c(`div`,_,[s[1]||=c(`span`,null,`타겟(target.png)`,-1),c(`input`,{type:`file`,id:`target-input`,accept:`image/*`,onChange:F},null,32)]),s[2]||=c(`div`,{class:`file-path-wrapper`},[c(`input`,{class:`file-path validate`,type:`text`,placeholder:`Perspective 변환할 이미지를 선택하세요`})],-1)])]),c(`div`,{class:`center-align`,style:{margin:`24px 0`}},[c(`button`,{id:`make-btn`,class:`btn waves-effect waves-light`,onClick:L},[...s[3]||=[c(`i`,{class:`material-icons left`},`layers`,-1),l(`최종 이미지 만들기 `,-1)]]),c(`button`,{id:`save-btn`,class:`btn green waves-effect waves-light`,onClick:R},[...s[4]||=[c(`i`,{class:`material-icons left`},`file_download`,-1),l(`PNG로 저장 `,-1)]])]),c(`canvas`,{id:`result-canvas`,ref_key:`resultCanvas`,ref:O},null,512),c(`div`,v,[s[5]||=c(`label`,{for:`humanPosition`,style:{color:`#1976d2`,"font-weight":`500`}},`인물 X 위치`,-1),c(`input`,{type:`range`,id:`humanPosition`,min:`0`,max:`1000`,step:`0.1`,value:e(w),onInput:I},null,40,y),c(`span`,b,r(e(w)),1)]),c(`a`,{id:`download-link`,class:`download-link btn blue`,style:{display:`none`},ref_key:`downloadLink`,ref:k},[...s[6]||=[c(`i`,{class:`material-icons left`},`file_download`,-1),l(`다운로드 `,-1)]],512)])])}}},[[`__scopeId`,`data-v-4ed6250e`]]);export{x as default};